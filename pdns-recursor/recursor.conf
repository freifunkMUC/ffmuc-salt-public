{%- set threads = [grains.num_cpus, 8] |Â min %}
dnssec:
  validation: validate
  negative_trustanchors:
  - name: web.de
    reason: They fucked up their shit
  - name: gmx.net
    reason: They fucked up their shit
  - name: tudos.de
    reason: They fucked up
  - name: gem2go.page
    reason: They fucked up
  - name: gemeinde.laas.bz.it
    reason: They fucked up
incoming:
  allow_from:
  {%- if 'dnsdist' in salt['pillar.get']('netbox:tag_list', []) %}
  - 127.0.0.1/32
  - ::1/128
  - 10.8.0.0/23
  - 10.80.248.32/27
  - 10.80.248.64/27
{%- else %}
  - 127.0.0.1/32
  - ::1/128
  - 10.80.0.0/16
  - 10.8.0.0/23
  - 2001:678:e68::/48
  - 2001:678:ed0::/48
{%- if 'parker-gateway' in salt['pillar.get']('netbox:role:name') %}
  - 2001:db8:ed0::/48
{%- endif %}{# 'parker-gateway' in salt['pillar.get']('netbox:role:name') #}
{%- endif %}{# 'dnsdist' in salt['pillar.get']('netbox:tag_list', []) #}
  distributor_threads: 2
  edns_padding_from:
  - 0.0.0.0/0
  listen:
  - 0.0.0.0
  - '::'
  pdns_distributes_queries: true
  {%- if 'dnsdist' in salt['pillar.get']('netbox:tag_list', []) %}
  port: 1653
  {%- endif %}
  reuseport: true
outgoing:
  source_address:
  - 0.0.0.0
  - '::'
recordcache:
  max_entries: 2000000
  zonetocaches:
    - zone: .
      method: url
      sources: ['https://www.internic.net/domain/root.zone']
recursor:
  server_id: dot.ffmuc.net
  version_string: dot.ffmuc.net
  threads: {{ threads }}
  tcp_threads: {{ threads }}
  {%- if 'parker-gateway' in salt['pillar.get']('netbox:role:name') %}
  dns64_prefix: 64:ff9b::/96
  {%- endif %}{# 'parker-gateway' in salt['pillar.get']('netbox:role:name') #}
webservice:
  address: 127.0.0.1
  allow_from:
  - 127.0.0.1
  - ::1
  webserver: true
